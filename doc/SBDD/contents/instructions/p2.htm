 
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<!-- #BeginTemplate "/Templates/ContentPageTemplate.dwt" --> 
<HEAD>
<!-- #BeginEditable "doctitle" --> 
<TITLE>Open Microscopy Environment</TITLE>
<!-- #EndEditable --> 
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<META name="author" content="Andrea Falconi">
<LINK rel="stylesheet" href="../../include/style.css" type="text/css">
</HEAD>
<BODY>
<A name="top"></A> 
<!-- Start of Top Bars -->
<TABLE cellspacing="0" cellpadding="0" width="100%" height="114" border="0">
  <TR> 
    <TD> 
      <!-- Start of TopBar1 -->
      <TABLE class="topBar1" cellspacing="0" cellpadding="0" width="100%" height="27" border="0">
        <TR> 
          <TD><A href="http://www.openmicroscopy.org/"><IMG src="../../graphx/ome_mit.gif" width="62" height="22" border="0" alt="Project's Home Page"></A></TD>
        </TR>
      </TABLE>
      <!-- End of TopBar1 -->
    </TD>
  </TR>
  <TR> 
    <TD> 
      <!-- Start of TopBar2 -->
      <TABLE class="topBar2" cellspacing="0" cellpadding="0" width="100%" height="24" border="0">
        <TR> 
          <TD align="top"><img src="../../graphx/sbdd.gif" width="350" height="24"></TD>
          <TD width="90%" align="top"><IMG src="../../graphx/spacer.gif" width="1" height="1"></TD>
          <TD align="top"><A href="../index.htm"><IMG src="../../graphx/contents.gif" width="67" height="24" border="0" alt="Table of Contents "></A></TD>
          <TD align="top"><IMG src="../../graphx/bar_sep.gif" width="14" height="24"></TD>
          <TD align="top"><A href="../intro/index.htm"><IMG src="../../graphx/intro.gif" width="100" height="24" border="0" alt="Document Overview"></A></TD>
          <TD align="top"><IMG src="../../graphx/bar_sep.gif" width="14" height="24"></TD>
          <TD align="top"><A href="../repository/index.htm"><IMG src="../../graphx/repository.gif" width="84" height="24" border="0" alt="The Project Repository"></A></TD>
          <TD align="top"><IMG src="../../graphx/bar_sep.gif" width="14" height="24"></TD>
          <TD align="top"><A href="../dependencies/index.htm"><IMG src="../../graphx/dependencies.gif" width="101" height="24" border="0" alt="Dependencies"></A></TD>
          <TD align="top"><IMG src="../../graphx/bar_sep.gif" width="14" height="24"></TD>
          <TD align="top"><A href="index.htm"><IMG src="../../graphx/build-deploy.gif" width="101" height="24" border="0" alt="Building and Deploying OME"></A></TD>
          <TD align="top"><IMG src="../../graphx/spacer.gif" width="30" height="8"></TD>
        </TR>
      </TABLE>
      <!-- End of TopBar2 -->
    </TD>
  </TR>
  <TR> 
    <TD> 
      <!-- Start of TopBar3 -->
      <TABLE class="topBar3" cellspacing="0" cellpadding="0" width="100%" height="63" border="0">
        <TR> 
          <TD width="10%"><A href="http://www.openmicroscopy.org/"><IMG src="../../graphx/logo.gif" width="216" height="47" border="0" alt="Project's Home Page"></A></TD>
          <TD width="80%" align="center" nowrap><!-- #BeginEditable "Section" -->IV. 
            Building and Deploying<!-- #EndEditable --></TD>
          <TD width="10%"><IMG src="../../graphx/image_informatics.gif" width="239" height="44"></TD>
        </TR>
      </TABLE>
      <!-- End of TopBar3 -->
    </TD>
  </TR>
</TABLE>
<!-- End of Top Bars -->
<BR>
<!-- Start of header -->
<TABLE width="90%" border="0" cellspacing="0" cellpadding="0" align="center">
  <TR> 
    <TD colspan="4" height="10">&nbsp;</TD>
  </TR>
  <TR> 
    <TD width="5%">&nbsp;</TD>
    <TD class="szSmall" width="80%" nowrap><A href="../../index.htm">SBDD</A>&gt;<!-- #BeginEditable "Link%20to%20section%20index%20page" --><A href="index.htm">Building 
      and Deploying</A><!-- #EndEditable --><!-- #BeginEditable "Current%20subsection" -->&gt;Deploying<!-- #EndEditable --></TD>
    <TD  width="10%" align="right" nowrap><!-- #BeginEditable "Link%20to%20previous%20page" --><A href="p1.htm"><IMG src="../../graphx/previous.gif" width="18" height="16" alt="Previous" border="0"></A><!-- #EndEditable -->&nbsp;&nbsp;&nbsp;<!-- #BeginEditable "Link%20to%20next%20page" --><A href="p3.htm"><IMG src="../../graphx/next.gif" width="18" height="16" alt="Next" border="0"></A><!-- #EndEditable --></TD>
    <TD width="5%">&nbsp;</TD>
  </TR>
  <TR> 
    <TD width="5%">&nbsp;</TD>
    <TD colspan="2" width="90%" align="center"> 
      <HR width="100%">
    </TD>
    <TD width="5%">&nbsp;</TD>
  </TR>
  <TR> 
    <TD colspan="4" height="20">&nbsp;</TD>
  </TR>
  <TR> 
    <TD class="header" colspan="4"><!-- #BeginEditable "Subsection%20title" -->IV-2. 
      Deploying<!-- #EndEditable --></TD>
  </TR>
  <TR> 
    <TD colspan="4" height="30">&nbsp;</TD>
  </TR>
</TABLE>
<!-- End of header -->
<BR>
<!-- #BeginEditable "Page%20contents" --> 
<TABLE width="90%" border="0" cellspacing="0" cellpadding="0" align="center">
  <TR> 
    <TD width="100%"> 
      <!-- Start of Page Contents -->
      <TABLE width="100%" border="0" cellspacing="0" cellpadding="0" align="center">
        <TR> 
          <TD class="szNorm" width="82%"> 
            <P>As a first step, you will have to create a directory to host some 
              of the OME components. We&#146;ll refer to this directory as OME_DEPLOY 
              in the following instructions. You may want to set OME_DEPLOY to 
              <i>/OME</i>, as in the following example:</P>
            <p><code>mkdir /OME</code></p>
            <p>You then create the following subdirectories in OME_DEPLOY:</p>
            <ul>
              <li>html</li>
              <li>JavaScript</li>
              <li>images</li>
              <li>cgi</li>
              <li>perl2</li>
            </ul>
            <p>After that, copy everything from:</p>
            <ul>
              <li><i>&lt;CVS_LOCAL&gt;/OME/src/html</i> to <i>&lt;OME_DEPLOY&gt;/html</i></li>
              <li><i>&lt;CVS_LOCAL&gt;/OME/src/JavaScript</i> to <i>&lt;OME_DEPLOY&gt;/JavaScript</i></li>
              <li><i>&lt;CVS_LOCAL&gt;/OME/images</i> to <i>&lt;OME_DEPLOY&gt;/images</i></li>
              <li><i>&lt;CVS_LOCAL&gt;/OME/src/perl2</i> to <i>&lt;OME_DEPLOY&gt;/perl2</i></li>
            </ul>
            <p>Obviously, you have to replace <i>&lt;CVS_LOCAL&gt;</i> and <i>&lt;OME_DEPLOY&gt;</i> 
              with the actual directories. Now, copy the <i>OME_JPEG</i> executable 
              from <i>&lt;CVS_LOCAL&gt;/OME/src/C</i> to <i>&lt;OME_DEPLOY&gt;/cgi</i>.</p>
            <p>All the above can be done by issuing the following commands (assuming 
              you are in CVS_LOCAL and that OME_DEPLOY is <i>/OME</i>):</p>
            <p><code>cp -r /OME/src/html /OME/html<br>
              cp -r /OME/src/JavaScript /OME/JavaScript<br>
              cp -r /OME/images /OME/images<br>
              cp -r /OME/src/perl2 /OME/perl2<br>
              mkdir /OME/cgi<br>
              cp /OME/src/C/OME_JPEG /OME/cgi/OME_JPEG</code></p>
			  Notice that CVS_LOCAL contains some <i>CVS</i> subdirectories. These 
            need not be copied as well. The above commands will uselessly copy 
            them too.</TD>
          <TD width="3%">&nbsp;</TD>
          <TD class="sideTxt" valign="top" width="15%">File system</TD>
        </TR>
        <TR> 
          <TD colspan="3" height="10">&nbsp;</TD>
        </TR>
      </TABLE>
      <TABLE width="100%" border="0" cellspacing="0" cellpadding="0" align="center">
        <TR> 
          <TD colspan="3" height="40">&nbsp;</TD>
        </TR>
        <TR> 
          <TD class="szNorm" width="82%"> 
            <p>You have to add a new user and a new group for OME. Name <code>ome</code> 
              both the OME user and the OME group. At this point, you have to 
              change the ownwership of the OME_DEPLOY directory and of everything 
              contained in there. Of course, the new user and group will have 
              to be <code>ome</code>, as in the following example (OME_DEPLOY 
              is <i>/OME</i>):</p>
            <p><code>chown -R ome:ome /OME</code></p>
            <p>The next step involves setting appropriate file and directory permissions 
              for the OME user and group. First of all, grant read/write/scan 
              privileges on the OME_DEPLOY directory (OME_DEPLOY is <i>/OME</i>):</p>
            <p><code>chmod 0770 /OME</code></p>
            <p>Then, grant read/scan privileges on the <i>html</i>, <i>JavaScript</i>, 
              <i>images</i>, <i>perl2</i> and <i>cgi</i> directories (OME_DEPLOY 
              is <i>/OME</i>):</p>
            <p><code><nobr>chmod 0550 /OME/html /OME/JavaScript /OME/images /OME/perl2 
              /OME/cgi</nobr></code></p>
            <p>Now, set read privileges for all the files in <i>html</i>, <i>JavaScript</i>, 
              <i>images</i>, and <i>perl2</i> (OME_DEPLOY is <i>/OME</i>):</p>
            <p><code>chmod -R 0440 /OME/html/* /OME/JavaScript/* /OME/images/* 
              /OME/perl2/*</code></p>
            <p>Finally, set read/execute privileges for all the files in <i>cgi</i> 
              (OME_DEPLOY is /OME):</p>
            <p><code>chmod -R 0550 /OME/cgi/*</code></p>
            <p>Notice that users that are not in the OME group have no rights 
              on files and directories in OME_DEPLOY. The only user in the OME 
              group other than the OME user shall be the Apache user. Add it to 
              the OME group (the Apache user name is often <code>apache</code>).</p>
          </TD>
          <TD width="3%">&nbsp;</TD>
          <TD class="sideTxt" valign="top" width="15%"> Users, ownership and permissions</TD>
        </TR>
        <TR> 
          <TD colspan="3" height="10">&nbsp;</TD>
        </TR>
      </TABLE>
      <TABLE width="100%" border="0" cellspacing="0" cellpadding="0" align="center">
        <TR> 
          <TD colspan="3" height="40">&nbsp;</TD>
        </TR>
        <TR> 
          <TD class="szNorm" width="82%"> 
            <p>You will need to configure Apache to run with mod_perl and serve 
              things out of <i>&lt;OME_DEPLOY&gt;/perl2</i>. Also, you will need 
              to configure Apache in order to serve static content, which is located 
              in the <i>images</i>, <i>html</i> and <i>JavaScript</i> directories 
              under OME_DEPLOY. <br>
              One quick way to do that is by configuring the Apache &#146;main&#146; 
              server. Follows an example of the relevant directives in your httpd.conf 
              file (<i>/OME</i> is OME_DEPLOY in this example):</p>
            <p><code>Alias /html/ /OME/html/<br>
              Alias /JavaScript/ /OME/JavaScript/<br>
              Alias /images/ /OME/images/<br>
              ScriptAlias /cgi/ /OME/cgi/<br>
              PerlSetEnv PERL5LIB /OME/perl2/<br>
              PerlFreshRestart On<br>
              &lt;IfModule mod_perl.c&gt;<br>
              &nbsp;&nbsp;&nbsp;&nbsp;Alias /perl2/ /OME/perl2/<br>
              &nbsp;&nbsp;&nbsp;&nbsp;&lt;Location /perl&gt;<br>
              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetHandler perl-script<br>
              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PerlHandler Apache::Registry<br>
              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Options +ExecCGI<br>
              &nbsp;&nbsp;&nbsp;&nbsp;&lt;/Location&gt;<br>
              &lt;/IfModule&gt;</code></p>
            <p>However, you may want to do this by using virtual hosts. You will 
              need a host name for your virtual host. Unless you register your 
              virtual host with a DNS, you need to set up your <i>/etc/hosts</i> 
              file to resolve this to an IP address. The same trick can be done 
              using NetInfo Manager on OS X. After sorting that out, you can simply 
              copy the above directives in your <code>&lt;VirtualHost&gt;</code> 
              block in the configuration file. </p>
            <p>When you&#146;re finished editing the configuration file, make 
              sure the syntax is correct by typing:</p>
            <p><code>sudo apachectl configtest</code></p>
            <p>Then, don&#146;t forget to restart Apache:</p>
            <p><code>sudo apachectl restart</code></p>
          </TD>
          <TD width="3%">&nbsp;</TD>
          <TD class="sideTxt" valign="top" width="15%"> Configuring Apache</TD>
        </TR>
        <TR> 
          <TD colspan="3" height="10">&nbsp;</TD>
        </TR>
      </TABLE>
      <TABLE width="100%" border="0" cellspacing="0" cellpadding="0" align="center">
        <TR> 
          <TD colspan="3" height="40">&nbsp;</TD>
        </TR>
        <TR> 
          <TD class="szNorm" width="82%"> 
            <p>If you are a developer, you may want to add the directive:</p>
            <p><code>PerlModule Apache::StatINC</code></p>
            <p>and the following two lines inside the <code>Location</code> block:</p>
            <p><code>PerlInitHandler Apache::StatINC<br>
              PerlSetVar StatINC_Debug 1</code></p>
            <p>These directives cause your entire Perl dependency chain (@INC) 
              to be checked for modifications each time a child services a request. 
              Very handy in development environments, but slow and unnecessary 
              in production.<br>
            </p>
            <p>A warning for developers. Some OME developers experienced problems 
              with virtual hosts. Apache was reported not to refresh consistently 
              with changes in the files that were pointed by the virtual host. 
              Should you experience similar problems, you can make use of symbolic 
              links.<br>
            </p>
          </TD>
          <TD width="3%">&nbsp;</TD>
          <TD class="sideTxt" valign="top" width="15%"> For developers</TD>
        </TR>
        <TR> 
          <TD colspan="3" height="10">&nbsp;</TD>
        </TR>
      </TABLE>
      <TABLE width="100%" border="0" cellspacing="0" cellpadding="0" align="center">
        <TR> 
          <TD colspan="3" height="40">&nbsp;</TD>
        </TR>
        <TR> 
          <TD class="szNorm" width="82%"> 
            <p>To finish up the installation, you will have to run the <i>bootstapOME.pl</i> 
              script contained in <i>OME/src/SQL</i> under CVS_LOCAL. This script 
              needs to be run as root and both Apache and PostgreSQL must be running.</p>
            <p>The <i>bootstrapOME.pl</i> will:</p>
            <ul>
              <li>Create some OME directories. You'll be asked to enter the OME 
                base directory; unless you have a particular reason not to do 
                so, we reccomend that you set this to the value of OME_DEPLOY 
                and then accept the default values for the repository and input 
                directories. </li>
              <li>Ask you to enter the database administrator username. This has 
                to be an already existing Unix user; we reccomend that you specifiy 
                the OME user, <code>ome</code>.</li>
              <li>Create the OME database and load the schema.</li>
              <li>Create an initial OME experimenter. This will default to whomever 
                you selected as the database administrator. After installation, 
                you can create new OME experimenters by running the <i>addOMEuser.pl</i> 
                script contained in <i>OME/src/SQL</i> under CVS_LOCAL.</li>
              <li>Install the core analysis modules.</li>
              <li>Create an analysis chain to run at image import.</li>
            </ul>
            <p><i><u>Note</u></i>: The <i>bootstapOME.pl</i> script will try to 
              find out the login name of the Apache user. Should it fail to do 
              that, you'll be asked to enter it manually.</p>
          </TD>
          <TD width="3%">&nbsp;</TD>
          <TD class="sideTxt" valign="top" width="15%"> Finishing up</TD>
        </TR>
        <TR> 
          <TD colspan="3" height="10">&nbsp;</TD>
        </TR>
      </TABLE>
      <TABLE width="100%" border="0" cellspacing="0" cellpadding="0" align="center">
        <TR> 
          <TD colspan="3" height="40">&nbsp;</TD>
        </TR>
        <TR> 
          <TD class="szNorm" width="82%"> 
            <p>Now, you only have to point your favourite Web browser to:</p>
            <p><code>http://your.ome.site/perl2/serve.pl?Page=OME::Web::Home</code></p>
            <p>(the actual host name and path before <code>serve.pl</code> depend 
              on how you configured Apache) </p>
            <p>Enjoy !</p>
          </TD>
          <TD width="3%">&nbsp;</TD>
          <TD class="sideTxt" valign="top" width="15%"> Accessing the system</TD>
        </TR>
        <TR> 
          <TD colspan="3" height="10">&nbsp;</TD>
        </TR>
      </TABLE>
      <!-- End of Page Contents -->
    </TD>
  </TR>
</TABLE>
<!-- #EndEditable --> <BR>
<!-- Start of footer -->
<TABLE width="90%" border="0" cellspacing="0" cellpadding="0" align="center">
  <TR> 
    <TD colspan="5" height="40">&nbsp;</TD>
  </TR>
  <TR> 
    <TD width="5%">&nbsp;</TD>
    <TD colspan="3" width="90%" align="center"> 
      <HR width="100%">
    </TD>
    <TD width="5%">&nbsp;</TD>
  </TR>
  <TR> 
    <TD width="5%">&nbsp;</TD>
    <TD width="25%"><A href="#top"><IMG src="../../graphx/top.gif" width="16" height="18" alt="Top" border="0"></A></TD>
    <TD class="header" id="hdSmall" width="40%" align="center" nowrap><!-- #BeginEditable "Cur%20subsection" -->Building 
      and Deploying<!-- #EndEditable --></TD>
    <TD width="25%" align="right" nowrap><!-- #BeginEditable "Lnk%20prev" --><A href="p1.htm"><IMG src="../../graphx/previous.gif" width="18" height="16" alt="Previous" border="0"></A><!-- #EndEditable -->&nbsp;&nbsp;&nbsp;<!-- #BeginEditable "Lnk%20next" --><A href="p3.htm"><IMG src="../../graphx/next.gif" width="18" height="16" alt="Next" border="0"></A><!-- #EndEditable --></TD>
    <TD width="5%">&nbsp;</TD>
  </TR>
  <TR> 
    <TD colspan="5" height="50">&nbsp;</TD>
  </TR>
</TABLE>
<!-- End of footer -->
</BODY>
<!-- #EndTemplate --> 
</HTML>
