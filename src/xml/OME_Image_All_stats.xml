<!-- This module does not conform to the schema and would not be processed properly. It's purpose is to explore potential. -->
<!-- The program it describes has not been written. The program would find plane, stack, and XYZT section statistics all at once. -->
<AnalysisModule Category = "Statistics" ModuleName = "Plane_Stack_XYZT_Stats" ModuleType = "OME::Analysis::CLIHandler" ProgramID = "/OME/bin/OME_Image_All_stats" Description = "Calculate pixel statistics for each XY plane, for each XYZ plane, and for each XYZT cross section.">
	<Declaration>
		<TableDefinition AttributeType = "I" TableName = "IMAGE_PIXEL_STATISTICS" 
			Description = "Pixel statistics. Produced from XML.">
			<Column ColumnID = "theZ" ColumnName = "THE_Z" SQL_DataType = "integer" Description = "Specifies Z spatial dimension"/>
			<Column ColumnID = "theW" ColumnName = "THE_W" SQL_DataType = "integer" Description = "Specifies Wavelength"/>
			<Column ColumnID = "theT" ColumnName = "THE_T" SQL_DataType = "integer" Description = "Specifies Timepoint"/>
			<Column ColumnID = "Min" ColumnName = "MIN" SQL_DataType = "integer" Description = "Minimum value"/>
			<Column ColumnID = "Max" ColumnName = "MAX" SQL_DataType = "integer" Description = "Maximum value"/>
			<Column ColumnID = "Mean" ColumnName = "MEAN" SQL_DataType = "float" Description = "Arithmetic Mean"/>
			<Column ColumnID = "Geomean" ColumnName = "GEOMEAN" SQL_DataType = "float" Description = "Geometric Mean"/>
			<Column ColumnID = "Sigma" ColumnName = "SIGMA" SQL_DataType = "float" Description = "Standard Deviation"/>
		</TableDefinition>
		<!-- Here are the base types: -->
		<!-- Notice that these FormalOutputs include FormalOutputID. I'm going to use them for polymorphism. -->
		<FormalOutput Name = "Min" FormalOutputID = "Min" Description = "Minimum pixel intensity">
			<FormalOutputColumn ColumnID = "Min" Description = "Minimum pixel intensity. Stored in Attribute_Columns"/>
		</FormalOutput>
		<FormalOutput Name = "Max" FormalOutputID = "Max" Description = "Maximum pixel intensity">
			<FormalOutputColumn ColumnID = "Max" Description = "Maximum pixel intensity. Stored in Attribute_Columns"/>
		</FormalOutput>
		<FormalOutput Name = "Mean" FormalOutputID = "Mean" Description = "Mean of pixel intensities">
			<FormalOutputColumn ColumnID = "Mean" Description = "Mean. Stored in Attribute_Columns"/>
		</FormalOutput>
		<FormalOutput Name = "GeoMean" FormalOutputID = "GeoMean" Description = "Geometric mean of pixel intensities">
			<FormalOutputColumn ColumnID = "Geomean" Description = "Geometric mean. Stored in Attribute_Columns"/>
		</FormalOutput>
		<FormalOutput Name = "Sigma" FormalOutputID = "Sigma" Description = "Standard deviation of pixel intensities">
			<FormalOutputColumn ColumnID = "Sigma" Description = "Standard Deviation. Stored in Attribute_Columns"/>
		</FormalOutput>
		<FormalOutput Name = "XYPlane" FormalOutputID = "Plane" Description = "Indexes uniquely describing an XY plane">
			<FormalOutputColumn ColumnID = "theZ" Description = "Z coordinate describing the XY Plane"/>
			<FormalOutputColumn ColumnID = "theW" Description = "Wavenumber describing the XY Plane"/>
			<FormalOutputColumn ColumnID = "theT" Description = "Timepoint describing the XY Plane"/>
		</FormalOutput>
		<FormalOutput Name = "XYZStack" FormalOutputID = "Stack" Description = "Indexes uniquely describing an XYZ stack">
			<FormalOutputColumn ColumnID = "theW" Description = "Wavenumber describing the XYZ stack"/>
			<FormalOutputColumn ColumnID = "theT" Description = "Timepoint describing the XYZ stack"/>
		</FormalOutput>
		<FormalOutput Name = "XYZT section" FormalOutputID = "XYZT" Description = "Indexes uniquely describing an XYZT section. This is the image restricted to one wavelength.">
			<FormalOutputColumn ColumnID = "theW" Description = "Wavenumber describing the XYZT section"/>
		</FormalOutput>
		<!-- End base types -->
		<!-- Begin complex types for Planes -->
		<FormalOutput Name = "XYPlaneMin" Description = "Minimum pixel intensity in an XY plane">
			<FormalOutput FormalOutputID = "Min"/>
			<FormalOutput FormalOutputID = "Plane"/>
		</FormalOutput>
		<FormalOutput Name = "XYPlaneMax" Description = "Maximum pixel intensity in an XY plane">
			<FormalOutput FormalOutputID = "Max"/>
			<FormalOutput FormalOutputID = "Plane"/>
		</FormalOutput>
		<FormalOutput Name = "XYPlaneMean" Description = "Mean of pixel intensities in an XY plane">
			<FormalOutput FormalOutputID = "Mean"/>
			<FormalOutput FormalOutputID = "Plane"/>
		</FormalOutput>
		<FormalOutput Name = "XYPlaneGeoMean" Description = "Geometric mean of pixel intensities in an XY plane">
			<FormalOutput FormalOutputID = "Geomean"/>
			<FormalOutput FormalOutputID = "Plane"/>
		</FormalOutput>
		<FormalOutput Name = "XYPlaneSigma" Description = "Standard deviation of pixel intensities in an XY plane">
			<FormalOutput FormalOutputID = "Sigma"/>
			<FormalOutput FormalOutputID = "Plane"/>
		</FormalOutput>
		<!-- End complex types for Planes -->
		<!-- Begin complex types for Stacks -->
		<FormalOutput Name = "XYZPlaneMin" Description = "Minimum pixel intensity in an XY plane">
			<FormalOutput FormalOutputID = "Min"/>
			<FormalOutput FormalOutputID = "Stack"/>
		</FormalOutput>
		<FormalOutput Name = "XYZPlaneMax" Description = "Maximum pixel intensity in an XY plane">
			<FormalOutput FormalOutputID = "Max"/>
			<FormalOutput FormalOutputID = "Stack"/>
		</FormalOutput>
		<FormalOutput Name = "XYZPlaneMean" Description = "Mean of pixel intensities in an XY plane">
			<FormalOutput FormalOutputID = "Mean"/>
			<FormalOutput FormalOutputID = "Stack"/>
		</FormalOutput>
		<FormalOutput Name = "XYZPlaneGeoMean" Description = "Geometric mean of pixel intensities in an XY plane">
			<FormalOutput FormalOutputID = "Geomean"/>
			<FormalOutput FormalOutputID = "Stack"/>
		</FormalOutput>
		<FormalOutput Name = "XYZPlaneSigma" Description = "Standard deviation of pixel intensities in an XY plane">
			<FormalOutput FormalOutputID = "Sigma"/>
			<FormalOutput FormalOutputID = "Stack"/>
		</FormalOutput>
		<!-- End complex types for Stacks -->
		<!-- Begin complex types for XYZT sections -->
		<FormalOutput Name = "XYZTPlaneMin" Description = "Minimum pixel intensity in an XYZT section">
			<FormalOutput FormalOutputID = "Min"/>
			<FormalOutput FormalOutputID = "XYZT"/>
		</FormalOutput>
		<FormalOutput Name = "XYZTPlaneMax" Description = "Maximum pixel intensity in an XYZT section">
			<FormalOutput FormalOutputID = "Max"/>
			<FormalOutput FormalOutputID = "XYZT"/>
		</FormalOutput>
		<FormalOutput Name = "XYZTPlaneMean" Description = "Mean of pixel intensities in an XYZT section">
			<FormalOutput FormalOutputID = "Mean"/>
			<FormalOutput FormalOutputID = "XYZT"/>
		</FormalOutput>
		<FormalOutput Name = "XYZTPlaneGeoMean" Description = "Geometric mean of pixel intensities in an XYZT section">
			<FormalOutput FormalOutputID = "Geomean"/>
			<FormalOutput FormalOutputID = "XYZT"/>
		</FormalOutput>
		<FormalOutput Name = "XYZTPlaneSigma" Description = "Standard deviation of pixel intensities in an XYZT section">
			<FormalOutput FormalOutputID = "Sigma"/>
			<FormalOutput FormalOutputID = "XYZT"/>
		</FormalOutput>
		<!-- End complex types for XYZT sections -->
	</Declaration>
	<ExecutionInstructions ExecutionPoint = "precalculateImage" MakesNewFeature = "false">
		<CommandLine>Path=<RawImageFilePath/> Dims=<sizeX/>,<sizeY/>,<sizeZ/>,<sizeT/>,<sizeW/>,<BytesPerPixel/></CommandLine>
		<STDOUT>
			<!-- The first section of the output is Plane statistics. -->
			<OutputRecord RepeatCount = "2">
				<pat>^.*?\n</pat>
			</OutputRecord>
			<!-- That eats two lines. The first line of the output is "BEGIN_PLANE_STATISTICS" and the second line is column headers -->
			<OutputRecord TerminateAt = "END_PLANE_STATISTICS">
				<pat>^(\d+)\t(\d+)\t(\d+)\t(\d+)\t(\d+)\t(\d+\.?\d*|\.\d+)\t(\d+\.?\d*|\.\d+)\t(\d+\.?\d*|\.\d+)\n</pat>
				<Output ColumnID = "theW" AccessBy = "1"/>
				<Output ColumnID = "theT" AccessBy = "2"/>
				<Output ColumnID = "theZ" AccessBy = "3"/>
				<Output ColumnID = "Min" AccessBy = "4"/>
				<Output ColumnID = "Max" AccessBy = "5"/>
				<Output ColumnID = "Mean" AccessBy = "6"/>
				<Output ColumnID = "Geomean" AccessBy = "7"/>
				<Output ColumnID = "Sigma" AccessBy = "8"/>
			</OutputRecord>
			<!-- That reads a line of output & repeats until it has reached the end of the stream. -->
			<!-- Plane statistics have been processed. -->
			<!-- The next section of the output is Stack statistics. -->
			<OutputRecord RepeatCount = "2">
				<pat>^.*?\n</pat>
			</OutputRecord>
			<!-- That eats two lines. The first line is "BEGIN_STACK_STATISTICS" and the second line is column headers -->
			<OutputRecord TerminateAt = "END_STACK_STATISTICS">
				<pat>^(\d+)\t(\d+)\t(\d+)\t(\d+)\t(\d+\.?\d*|\.\d+)\t(\d+\.?\d*|\.\d+)\t(\d+\.?\d*|\.\d+)\n</pat>
				<Output ColumnID = "theW" AccessBy = "1"/>
				<Output ColumnID = "theT" AccessBy = "2"/>
				<Output ColumnID = "Min" AccessBy = "3"/>
				<Output ColumnID = "Max" AccessBy = "4"/>
				<Output ColumnID = "Mean" AccessBy = "5"/>
				<Output ColumnID = "Geomean" AccessBy = "6"/>
				<Output ColumnID = "Sigma" AccessBy = "7"/>
			</OutputRecord>
			<!-- That reads a line of output & repeats until it has reached the end of the stream. -->
			<!-- Stack statistics have been processed. -->
			<!-- The next section of the output is XYZT statistics. -->
			<OutputRecord RepeatCount = "2">
				<pat>^.*?\n</pat>
			</OutputRecord>
			<!-- That eats two lines. The first line is "END_XYZT_STATISTICS" and the second line is column headers -->
			<OutputRecord TerminateAt = "END_XYZT_STATISTICS">
				<pat>^(\d+)\t(\d+)\t(\d+)\t(\d+\.?\d*|\.\d+)\t(\d+\.?\d*|\.\d+)\t(\d+\.?\d*|\.\d+)\n</pat>
				<Output ColumnID = "theW" AccessBy = "1"/>
				<Output ColumnID = "Min" AccessBy = "2"/>
				<Output ColumnID = "Max" AccessBy = "3"/>
				<Output ColumnID = "Mean" AccessBy = "4"/>
				<Output ColumnID = "Geomean" AccessBy = "5"/>
				<Output ColumnID = "Sigma" AccessBy = "6"/>
			</OutputRecord>
			<!-- That reads a line of output & repeats until it has reached the end of the stream. -->
			<!-- XYZT statistics have been processed. That's it. -->
		</STDOUT>
	</ExecutionInstructions>
</AnalysisModule>
